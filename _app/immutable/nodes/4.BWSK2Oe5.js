var K=Object.defineProperty;var W=(o,e,t)=>e in o?K(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var J=(o,e,t)=>W(o,typeof e!="symbol"?e+"":e,t);import{S as X,i as Y,s as Z,n as z,d as _,C as ee,E as R,b as V,a as M,e as i,I as D,Q as te,F as c,f as b,g as k,L as B,h as P,c as G,j as y,k as U,t as Q,l as se}from"../chunks/DnGBHVzR.js";import"../chunks/IHki7fMi.js";import{g as re}from"../chunks/CMWlCmse.js";import{p as ae}from"../chunks/BYdborAI.js";const oe="http://localhost:8000";class ne{constructor(e=oe){J(this,"baseURL");this.baseURL=e}getAuthToken(){return localStorage.getItem("auth_token")}async request(e,t={}){const a=this.getAuthToken(),n={"Content-Type":"application/json",...t.headers};a&&(n.Authorization=`Bearer ${a}`);const r={...t,headers:n};try{const s=await fetch(`${this.baseURL}${e}`,r),u=await s.json();return s.ok?{success:!0,status:s.status,data:u,message:u.message||"Success"}:{success:!1,status:s.status,error:u.message||`HTTP Error: ${s.status}`,message:u.message||`HTTP Error: ${s.status}`}}catch(s){return{success:!1,status:0,error:s instanceof Error?s.message:"Network error",message:s instanceof Error?s.message:"Network error"}}}async signIn(e,t){return this.request("/auth/signin",{method:"POST",body:JSON.stringify({email:e,password:t})})}async signUp(e){return this.request("/auth/signup",{method:"POST",body:JSON.stringify(e)})}async signOut(){const e=await this.request("/auth/signout",{method:"POST"});return e.success&&localStorage.removeItem("auth_token"),e}async refreshToken(){return this.request("/auth/refresh",{method:"POST"})}async getCurrentUser(){return this.request("/auth/me")}async updateProfile(e){return this.request("/auth/profile",{method:"PUT",body:JSON.stringify(e)})}async getObservations(e){const t=new URLSearchParams;e&&(e.limit&&t.set("limit",e.limit.toString()),e.offset&&t.set("offset",e.offset.toString()),e.species&&t.set("species",e.species),e.observationType&&t.set("type",e.observationType),e.location&&(t.set("lat",e.location.lat.toString()),t.set("lng",e.location.lng.toString()),t.set("radius",e.location.radius.toString())),e.dateRange&&(t.set("start_date",e.dateRange.start),t.set("end_date",e.dateRange.end)));const a=`/observations${t.toString()?`?${t.toString()}`:""}`;return this.request(a)}async createObservation(e){return this.request("/observations",{method:"POST",body:JSON.stringify(e)})}async getObservation(e){return this.request(`/observations/${e}`)}async updateObservation(e,t){return this.request(`/observations/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteObservation(e){return this.request(`/observations/${e}`,{method:"DELETE"})}async searchSpecies(e,t){const a=new URLSearchParams({q:e});return t&&(a.set("lat",t.lat.toString()),a.set("lng",t.lng.toString())),this.request(`/species/search?${a.toString()}`)}async getSpecies(e){return this.request(`/species/${e}`)}async uploadImage(e){const t=new FormData;t.append("image",e);const a=this.getAuthToken(),n={};a&&(n.Authorization=`Bearer ${a}`);try{const r=await fetch(`${this.baseURL}/uploads/images`,{method:"POST",headers:n,body:t}),s=await r.json();return r.ok?{success:!0,status:r.status,data:s,message:"Upload successful"}:{success:!1,status:r.status,error:s.message||`Upload failed: ${r.status}`,message:s.message||`Upload failed: ${r.status}`}}catch(r){return{success:!1,status:0,error:r instanceof Error?r.message:"Upload error",message:r instanceof Error?r.message:"Upload error"}}}async uploadAudio(e){const t=new FormData;t.append("audio",e);const a=this.getAuthToken(),n={};a&&(n.Authorization=`Bearer ${a}`);try{const r=await fetch(`${this.baseURL}/uploads/audio`,{method:"POST",headers:n,body:t}),s=await r.json();return r.ok?{success:!0,status:r.status,data:s,message:"Upload successful"}:{success:!1,status:r.status,error:s.message||`Upload failed: ${r.status}`,message:s.message||`Upload failed: ${r.status}`}}catch(r){return{success:!1,status:0,error:r instanceof Error?r.message:"Upload error",message:r instanceof Error?r.message:"Upload error"}}}async geocodeLocation(e){const t=new URLSearchParams({q:e});return this.request(`/geocode?${t.toString()}`)}async reverseGeocode(e,t){const a=new URLSearchParams({lat:e.toString(),lng:t.toString()});return this.request(`/geocode/reverse?${a.toString()}`)}}const ie=new ne;function H(o){let e,t;return{c(){e=y("div"),t=Q(o[2]),this.h()},l(a){e=b(a,"DIV",{class:!0});var n=k(e);t=G(n,o[2]),n.forEach(_),this.h()},h(){c(e,"class","mb-4 text-red-600 bg-red-100 p-3 rounded")},m(a,n){M(a,e,n),i(e,t)},p(a,n){n&4&&V(t,a[2])},d(a){a&&_(e)}}}function ue(o){let e,t,a="Sign In",n,r,s,u,g,O="Email",q,h,w,m,v,x="Password",A,p,$,S,E=o[3]?"Signing in…":"Sign In",I,N,j,l=o[2]&&H(o);return{c(){e=y("section"),t=y("h1"),t.textContent=a,n=U(),l&&l.c(),r=U(),s=y("form"),u=y("div"),g=y("label"),g.textContent=O,q=U(),h=y("input"),w=U(),m=y("div"),v=y("label"),v.textContent=x,A=U(),p=y("input"),$=U(),S=y("button"),I=Q(E),this.h()},l(d){e=b(d,"SECTION",{class:!0});var f=k(e);t=b(f,"H1",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-10m20d1"&&(t.textContent=a),n=P(f),l&&l.l(f),r=P(f),s=b(f,"FORM",{class:!0});var T=k(s);u=b(T,"DIV",{});var L=k(u);g=b(L,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),B(g)!=="svelte-18l4ffq"&&(g.textContent=O),q=P(L),h=b(L,"INPUT",{id:!0,type:!0,class:!0}),L.forEach(_),w=P(T),m=b(T,"DIV",{});var C=k(m);v=b(C,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),B(v)!=="svelte-t0lq1a"&&(v.textContent=x),A=P(C),p=b(C,"INPUT",{id:!0,type:!0,class:!0}),C.forEach(_),$=P(T),S=b(T,"BUTTON",{type:!0,class:!0});var F=k(S);I=G(F,E),F.forEach(_),T.forEach(_),f.forEach(_),this.h()},h(){c(t,"class","text-2xl font-bold mb-4 text-center"),c(g,"class","block mb-1 font-medium"),c(g,"for","email"),c(h,"id","email"),c(h,"type","email"),c(h,"class","w-full px-4 py-2 border rounded focus:outline-none focus:ring focus:border-green-500"),h.required=!0,c(v,"class","block mb-1 font-medium"),c(v,"for","password"),c(p,"id","password"),c(p,"type","password"),c(p,"class","w-full px-4 py-2 border rounded focus:outline-none focus:ring focus:border-green-500"),p.required=!0,c(S,"type","submit"),c(S,"class","w-full py-2 px-4 bg-green-600 text-white font-semibold rounded hover:bg-green-700 disabled:opacity-50"),S.disabled=o[3],c(s,"class","space-y-4"),c(e,"class","max-w-md mx-auto mt-10 p-6 bg-white dark:bg-neutral-soft-black rounded-lg shadow-md")},m(d,f){M(d,e,f),i(e,t),i(e,n),l&&l.m(e,null),i(e,r),i(e,s),i(s,u),i(u,g),i(u,q),i(u,h),R(h,o[0]),i(s,w),i(s,m),i(m,v),i(m,A),i(m,p),R(p,o[1]),i(s,$),i(s,S),i(S,I),N||(j=[D(h,"input",o[6]),D(p,"input",o[7]),D(s,"submit",te(o[4]))],N=!0)},p(d,[f]){d[2]?l?l.p(d,f):(l=H(d),l.c(),l.m(e,r)):l&&(l.d(1),l=null),f&1&&h.value!==d[0]&&R(h,d[0]),f&2&&p.value!==d[1]&&R(p,d[1]),f&8&&E!==(E=d[3]?"Signing in…":"Sign In")&&V(I,E),f&8&&(S.disabled=d[3])},i:z,o:z,d(d){d&&_(e),l&&l.d(),N=!1,ee(j)}}}function le(o,e,t){let a,n;se(o,ae,w=>t(5,n=w));let r="",s="",u="",g=!1;async function O(w){w.preventDefault(),t(2,u=""),t(3,g=!0);const m=await ie.signIn(r,s);m.success?(localStorage.setItem("auth_token",m.data.token),re(a)):t(2,u=m.error||"Failed to sign in"),t(3,g=!1)}function q(){r=this.value,t(0,r)}function h(){s=this.value,t(1,s)}return o.$$.update=()=>{o.$$.dirty&32&&(a=n.url.searchParams.get("redirect")||"/observations")},[r,s,u,g,O,n,q,h]}class me extends X{constructor(e){super(),Y(this,e,le,ue,Z,{})}}export{me as component};
