const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C1-YiHia.js","../chunks/Cpj98o6Y.js","../chunks/CFEr02u7.js"])))=>i.map(i=>d[i]);
import{S as Z,i as H,s as J,n as U,d as O,R as B,e as W,k as m,F as A,l as I,m as P,p as L,r as K,T as ae,M as Q,U as ne,V as re,w as oe,t as ie,a as se,j as N,x as le,L as ce,o as j,f as x,y as ue,q as V,h as E,z as de}from"../chunks/jMbKbsP8.js";import"../chunks/IHki7fMi.js";import{_ as q}from"../chunks/C1FmrZbK.js";import{u as me,f as fe,o as G}from"../chunks/GL9VYkxv.js";function he(n){let t,a;return{c(){t=L("div"),a=L("div"),this.h()},l(l){t=I(l,"DIV",{class:!0,style:!0});var r=P(t);a=I(r,"DIV",{class:!0}),P(a).forEach(O),r.forEach(O),this.h()},h(){A(a,"class","map-container w-full h-full rounded-lg"),A(t,"class","observation-map-container"),B(t,"height",n[0])},m(l,r){W(l,t,r),m(t,a),n[12](a)},p(l,[r]){r&1&&B(t,"height",l[0])},i:U,o:U,d(l){l&&O(t),n[12](null)}}}function pe(n,t,a){return n.filter(l=>!!a[l.observation_type])}function ge(n){return`
      <div class="observation-popup">
        <h3>${n.species_name||"Unknown Species"}</h3>
        <p><strong>Type:</strong> ${n.observation_type}</p>
        <p><strong>Date:</strong> ${new Date(n.created_at).toLocaleDateString()}</p>
        ${n.description?`<p>${n.description}</p>`:""}
      </div>
    `}function _e(n,t,a){let l;K(n,fe,e=>a(17,l=e));let r,f;const p=ae();let{observations:S=[]}=t,{selectedObservation:g=null}=t,{centerLocation:_=null}=t,{zoom:M=10}=t,{height:b="500px"}=t,{enableClustering:C=!0}=t,{enableAudioPlayback:w=!0}=t,{showFilters:D=!0}=t,k,o,u,h=new Map,s=!1,d=l,y={visual:!0,audio:!0,"multi-modal":!0,plant:!0,verified:!1},v=[];Q(async()=>{var e,i;try{r=(await q(()=>import("../chunks/C1-YiHia.js").then(F=>F.l),__vite__mapDeps([0,1]),import.meta.url)).default;try{await q(()=>import("../chunks/CFEr02u7.js").then(F=>F.l),__vite__mapDeps([2,1]),import.meta.url),f=r.markerClusterGroup}catch(F){console.warn("leaflet.markercluster import failed:",F),a(2,C=!1)}delete r.Icon.Default.prototype._getIconUrl,r.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"}),await z()}catch(c){console.error("Failed to initialize map:",c),(i=(e=me)==null?void 0:e.showNotification)==null||i.call(e,"error","Failed to load map. Please refresh the page.")}}),ne(()=>{o&&(o.remove(),a(9,o=null)),h.clear()});async function z(){if(!(!r||!k))try{const e=_?[_.latitude,_.longitude]:[40.7128,-74.006];a(9,o=r.map(k,{center:e,zoom:M,zoomControl:!0,attributionControl:!0})),r.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors",maxZoom:19}).addTo(o),C&&f&&(u=f({chunkedLoading:!0,maxClusterRadius:50,iconCreateFunction:ee}),o.addLayer(u)),o.on("moveend",T),o.on("zoomend",T),a(10,s=!0),v.length>0&&R(v)}catch(e){throw console.error("Map initialization failed:",e),e}}function R(e){if(!(!o||!s))try{u?u.clearLayers():h.forEach(i=>o.removeLayer(i)),h.clear(),e.forEach(i=>{const c=Y(i);c&&(h.set(i.id,c),u?u.addLayer(c):c.addTo(o))})}catch(i){console.error("Failed to update markers:",i)}}function X(e){if(!o||!e.location)return;o.setView([e.location.latitude,e.location.longitude],15);const i=h.get(e.id);i&&i.openPopup()}function Y(e){if(!r||!e.location)return null;const i=$(e.observation_type),c=r.marker([e.location.latitude,e.location.longitude],{icon:i}),F=ge(e);return c.bindPopup(F),c.on("click",()=>{p("observationSelected",e),p("markerClicked",{observation:e,marker:c})}),c}function $(e){const i={visual:"ğŸ“¸",audio:"ğŸ”Š","multi-modal":"ğŸ¬",plant:"ğŸŒ¿"};return r.divIcon({html:`<div class="observation-marker ${e}">${i[e]||"ğŸ“"}</div>`,className:"custom-marker",iconSize:[30,30],iconAnchor:[15,15]})}function ee(e){const i=e.getChildCount();let c="small";return i>=100?c="large":i>=10&&(c="medium"),r.divIcon({html:`<div class="cluster-marker cluster-${c}"><span>${i}</span></div>`,className:"marker-cluster",iconSize:[40,40]})}function T(){if(!o)return;const e=o.getBounds(),i={north:e.getNorth(),south:e.getSouth(),east:e.getEast(),west:e.getWest(),zoom:o.getZoom()};p("boundsChanged",i)}function te(e){re[e?"unshift":"push"](()=>{k=e,a(1,k)})}return n.$$set=e=>{"observations"in e&&a(3,S=e.observations),"selectedObservation"in e&&a(4,g=e.selectedObservation),"centerLocation"in e&&a(5,_=e.centerLocation),"zoom"in e&&a(6,M=e.zoom),"height"in e&&a(0,b=e.height),"enableClustering"in e&&a(2,C=e.enableClustering),"enableAudioPlayback"in e&&a(7,w=e.enableAudioPlayback),"showFilters"in e&&a(8,D=e.showFilters)},n.$$.update=()=>{n.$$.dirty&8&&a(11,v=pe(S,d,y)),n.$$.dirty&3584&&o&&s&&v&&R(v),n.$$.dirty&1552&&o&&g&&s&&X(g)},[b,k,C,S,g,_,M,w,D,o,s,v,te]}class be extends Z{constructor(t){super(),H(this,t,_e,he,J,{observations:3,selectedObservation:4,centerLocation:5,zoom:6,height:0,enableClustering:2,enableAudioPlayback:7,showFilters:8})}}function ve(n){let t,a,l="Leopold Observation Map",r,f,p,S,g=n[0].length+"",_,M,b,C,w=n[0].length+"",D,k,o,u,h;return u=new be({props:{observations:n[0],centerLocation:{latitude:40.7128,longitude:-74.006},enableClustering:!0,enableAudioPlayback:!0,height:"70vh"}}),{c(){t=L("div"),a=L("h1"),a.textContent=l,r=V(),f=L("div"),p=L("p"),S=E("Observations loaded: "),_=E(g),M=V(),b=L("p"),C=E("Map should show: "),D=E(w),k=E(" markers"),o=V(),de(u.$$.fragment),this.h()},l(s){t=I(s,"DIV",{class:!0});var d=P(t);a=I(d,"H1",{class:!0,"data-svelte-h":!0}),ce(a)!=="svelte-18gg9l"&&(a.textContent=l),r=j(d),f=I(d,"DIV",{class:!0});var y=P(f);p=I(y,"P",{});var v=P(p);S=x(v,"Observations loaded: "),_=x(v,g),v.forEach(O),M=j(y),b=I(y,"P",{});var z=P(b);C=x(z,"Map should show: "),D=x(z,w),k=x(z," markers"),z.forEach(O),y.forEach(O),o=j(d),ue(u.$$.fragment,d),d.forEach(O),this.h()},h(){A(a,"class","text-2xl font-bold mb-4"),A(f,"class","mb-4 p-2 bg-blue-100 rounded"),A(t,"class","container mx-auto p-4")},m(s,d){W(s,t,d),m(t,a),m(t,r),m(t,f),m(f,p),m(p,S),m(p,_),m(f,M),m(f,b),m(b,C),m(b,D),m(b,k),m(t,o),le(u,t,null),h=!0},p(s,[d]){(!h||d&1)&&g!==(g=s[0].length+"")&&N(_,g),(!h||d&1)&&w!==(w=s[0].length+"")&&N(D,w);const y={};d&1&&(y.observations=s[0]),u.$set(y)},i(s){h||(se(u.$$.fragment,s),h=!0)},o(s){ie(u.$$.fragment,s),h=!1},d(s){s&&O(t),oe(u)}}}function ke(n,t,a){let l;return K(n,G,r=>a(0,l=r)),Q(()=>{const r=[{id:"1",species_name:"American Robin",scientific_name:"Turdus migratorius",observation_type:"visual",location:{latitude:40.7128,longitude:-74.006},created_at:new Date().toISOString(),description:"Robin spotted in Central Park",user_id:"mock-user",is_verified:!1,images:[],tags:["urban","common"]},{id:"2",species_name:"Blue Jay",scientific_name:"Cyanocitta cristata",observation_type:"audio",location:{latitude:40.7589,longitude:-73.9851},created_at:new Date().toISOString(),description:"Blue jay territorial call",user_id:"mock-user",is_verified:!0,audio_recording:{url:"mock.wav",duration:15},tags:["call","territorial"]},{id:"3",species_name:"Cardinal",scientific_name:"Cardinalis cardinalis",observation_type:"multi-modal",location:{latitude:40.7505,longitude:-73.9934},created_at:new Date().toISOString(),description:"Male cardinal with distinctive call",user_id:"mock-user",is_verified:!1,images:["mock.jpg"],audio_recording:{url:"mock2.wav",duration:8},tags:["red","male","song"]}];G.addMany(r)}),[l]}class Se extends Z{constructor(t){super(),H(this,t,ke,ve,J,{})}}export{Se as component};
