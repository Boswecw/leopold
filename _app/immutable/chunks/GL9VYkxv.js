import{d as u,w as d}from"./Cv4MWLXe.js";function f(){const{subscribe:n,set:o,update:s}=d([]);return{subscribe:n,set:o,update:s,add:r=>s(e=>[...e,r]),remove:r=>s(e=>e.filter(t=>t.id!==r)),updateObservation:(r,e)=>s(t=>t.map(i=>i.id===r?{...i,...e}:i)),clear:()=>o([]),addMany:r=>s(e=>[...e,...r]),getByUserId:r=>{let e=[];return n(i=>{e=i.filter(a=>a.user_id===r)})(),e},getByType:r=>{let e=[];return n(i=>{e=i.filter(a=>a.observation_type===r)})(),e}}}const g=f();function h(){const n={user:null,isAuthenticated:!1,isLoading:!1,error:null},{subscribe:o,set:s,update:r}=d(n);return{subscribe:o,set:s,update:r,login:e=>{if(r(t=>({...t,user:e,isAuthenticated:!0,isLoading:!1,error:null})),e)try{localStorage.setItem("leopold_user",JSON.stringify(e))}catch(t){console.warn("Failed to save user to localStorage:",t)}},logout:()=>{s(n);try{localStorage.removeItem("leopold_user"),localStorage.removeItem("auth_token")}catch(e){console.warn("Failed to clear user from localStorage:",e)}},setLoading:e=>r(t=>({...t,isLoading:e})),setError:e=>r(t=>({...t,error:e,isLoading:!1})),clearError:()=>r(e=>({...e,error:null})),initialize:()=>{try{const e=localStorage.getItem("leopold_user"),t=localStorage.getItem("auth_token");if(e&&t){const i=JSON.parse(e);r(a=>({...a,user:i,isAuthenticated:!0}))}}catch(e){console.warn("Failed to initialize auth from localStorage:",e)}},updateProfile:e=>r(t=>{if(t.user){const i={...t.user,...e};try{localStorage.setItem("leopold_user",JSON.stringify(i))}catch(a){console.warn("Failed to save updated user:",a)}return{...t,user:i}}return t})}}const m=h();function v(){const n={loading:"idle",notifications:[],modals:{isOpen:!1,component:null,props:{}},sidebar:{isOpen:!1},theme:"light",error:null},{subscribe:o,set:s,update:r}=d(n);return{subscribe:o,set:s,update:r,setLoading:e=>r(t=>({...t,loading:e})),showNotification:(e,t,i=5e3)=>{const a={id:crypto.randomUUID(),type:e,message:t,timestamp:Date.now(),duration:i};return r(l=>({...l,notifications:[...l.notifications,a]})),i>0&&setTimeout(()=>{r(l=>({...l,notifications:l.notifications.filter(c=>c.id!==a.id)}))},i),a.id},removeNotification:e=>r(t=>({...t,notifications:t.notifications.filter(i=>i.id!==e)})),clearNotifications:()=>r(e=>({...e,notifications:[]})),openModal:(e,t={})=>r(i=>({...i,modals:{isOpen:!0,component:e,props:t}})),closeModal:()=>r(e=>({...e,modals:{isOpen:!1,component:null,props:{}}})),toggleSidebar:()=>r(e=>({...e,sidebar:{isOpen:!e.sidebar.isOpen}})),openSidebar:()=>r(e=>({...e,sidebar:{isOpen:!0}})),closeSidebar:()=>r(e=>({...e,sidebar:{isOpen:!1}})),setTheme:e=>{r(t=>({...t,theme:e}));try{localStorage.setItem("leopold_theme",e),e==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}catch(t){console.warn("Failed to save theme preference:",t)}},toggleTheme:()=>{let e="light";o(a=>{e=a.theme})();const i=e==="light"?"dark":"light";r(a=>({...a,theme:i}));try{localStorage.setItem("leopold_theme",i),i==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}catch(a){console.warn("Failed to save theme preference:",a)}},setError:e=>r(t=>({...t,error:e,loading:"error"})),clearError:()=>r(e=>({...e,error:null})),initialize:()=>{try{const e=localStorage.getItem("leopold_theme");e&&(e==="light"||e==="dark")&&(r(t=>({...t,theme:e})),e==="dark"&&document.documentElement.classList.add("dark"))}catch(e){console.warn("Failed to initialize UI preferences:",e)}}}}const b=v();function S(){const n={species:[],location:void 0,dateRange:void 0,observationType:void 0,user:void 0,tags:[],verified:void 0,sortBy:"created_at",sortOrder:"desc"},{subscribe:o,set:s,update:r}=d(n);return{subscribe:o,set:s,update:r,setSpecies:e=>r(t=>({...t,species:e})),addSpecies:e=>r(t=>({...t,species:[...t.species||[],e]})),removeSpecies:e=>r(t=>({...t,species:(t.species||[]).filter(i=>i!==e)})),setLocation:e=>r(t=>({...t,location:e})),setLocationFromPoint:(e,t)=>r(i=>({...i,location:{center:e,radius_km:t}})),setDateRange:e=>r(t=>({...t,dateRange:e})),setObservationType:e=>r(t=>({...t,observationType:e})),setUser:e=>r(t=>({...t,user:e})),setTags:e=>r(t=>({...t,tags:e})),addTag:e=>r(t=>({...t,tags:[...t.tags||[],e]})),removeTag:e=>r(t=>({...t,tags:(t.tags||[]).filter(i=>i!==e)})),setVerified:e=>r(t=>({...t,verified:e})),setSorting:(e,t="desc")=>r(i=>({...i,sortBy:e,sortOrder:t})),reset:()=>s(n),clearSpecies:()=>r(e=>({...e,species:[]})),clearLocation:()=>r(e=>({...e,location:void 0})),clearDateRange:()=>r(e=>({...e,dateRange:void 0})),clearObservationType:()=>r(e=>({...e,observationType:void 0})),clearUser:()=>r(e=>({...e,user:void 0})),clearTags:()=>r(e=>({...e,tags:[]})),clearVerified:()=>r(e=>({...e,verified:void 0}))}}const y=S();function w(){const n={isRecording:!1,isPlaying:!1,hasPermission:!1,currentRecording:null,error:null,recordingTime:0,audioLevel:0,supportedFormats:["webm","mp4","wav"],settings:{sampleRate:44100,channels:1,bitsPerSample:16}},{subscribe:o,set:s,update:r}=d(n);return{subscribe:o,set:s,update:r,startRecording:()=>r(e=>({...e,isRecording:!0,recordingTime:0,error:null})),stopRecording:()=>r(e=>({...e,isRecording:!1})),startPlaying:()=>r(e=>({...e,isPlaying:!0})),stopPlaying:()=>r(e=>({...e,isPlaying:!1})),setPermission:e=>r(t=>({...t,hasPermission:e})),setCurrentRecording:e=>r(t=>({...t,currentRecording:e})),clearCurrentRecording:()=>r(e=>({...e,currentRecording:null})),setAudioLevel:e=>r(t=>({...t,audioLevel:e})),setRecordingTime:e=>r(t=>({...t,recordingTime:e})),incrementRecordingTime:()=>r(e=>({...e,recordingTime:e.recordingTime+1})),setError:e=>r(t=>({...t,error:e,isRecording:!1,isPlaying:!1})),clearError:()=>r(e=>({...e,error:null})),updateSettings:e=>r(t=>({...t,settings:{...t.settings,...e}})),reset:()=>s(n)}}w();u([g,y],([n,o])=>{let s=n;if(o.species&&o.species.length>0&&(s=s.filter(t=>o.species.some(i=>{var a,l;return((a=t.species_name)==null?void 0:a.toLowerCase().includes(i.toLowerCase()))||((l=t.scientific_name)==null?void 0:l.toLowerCase().includes(i.toLowerCase()))}))),o.observationType&&o.observationType!=="all"&&(s=s.filter(t=>t.observation_type===o.observationType)),o.user&&(s=s.filter(t=>t.user_id===o.user)),o.tags&&o.tags.length>0&&(s=s.filter(t=>t.tags&&o.tags.some(i=>t.tags.includes(i)))),o.verified!==void 0&&(s=s.filter(t=>t.is_verified===o.verified)),o.dateRange){const{start:t,end:i}=o.dateRange;s=s.filter(a=>{const l=new Date(a.created_at),c=t?new Date(t):null,p=i?new Date(i):null;return(!c||l>=c)&&(!p||l<=p)})}const r=o.sortBy||"created_at",e=o.sortOrder||"desc";return s.sort((t,i)=>{let a=t[r],l=i[r];r.includes("_at")&&(a=new Date(a).getTime(),l=new Date(l).getTime()),typeof a=="string"&&(a=a.toLowerCase(),l=l.toLowerCase());const c=a<l?-1:a>l?1:0;return e==="desc"?-c:c}),s});u([g,m],([n,o])=>o.user?n.filter(s=>s.user_id===o.user.id):[]);u([g,m],([n,o])=>({total:n.length,byUser:o.user?n.filter(r=>r.user_id===o.user.id).length:0,byType:{visual:n.filter(r=>r.observation_type==="visual").length,audio:n.filter(r=>r.observation_type==="audio").length,"multi-modal":n.filter(r=>r.observation_type==="multi-modal").length},uniqueSpecies:new Set(n.map(r=>r.species_name).filter(Boolean)).size,verified:n.filter(r=>r.is_verified).length,thisWeek:(()=>{const r=new Date(Date.now()-6048e5);return n.filter(e=>new Date(e.created_at)>r).length})(),thisMonth:(()=>{const r=new Date(Date.now()-2592e6);return n.filter(e=>new Date(e.created_at)>r).length})()}));m.initialize(),b.initialize();export{m as a,y as f,g as o,b as u};
